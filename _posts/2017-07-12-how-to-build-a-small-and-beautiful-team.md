---
layout: post
title: 如何打造一个小而美的团队 
category: devops交付流程
date: 2017-07-12 22:11:11.000000000 +09:00
tags: devops,continuous-integration,agile,user-story,docker,gitlab-ci merge-request,test-driven-development,domain-driven-design,common-language 
---
> ### 我们为什么要打造一个小而美的团队

当前国内的互联网的发展可谓是非常的迅速，创业公司希望能尽快地交付自己的产品，大公司也希望迅速地迭代自己的产品甚至做出转型的尝试，也就是出现圈内所谓的“快速试错”的价值观或者是风气。

当然，"快速试错"本身并没有什么问题，甚至快速计划和交付，获取反馈和学习，也正是不少成功的企业总结出来的实践指导理论，比如说著名的**日本丰田**的**“精益工作法”**中的**“戴明环”**:
![](/img/pdca.jpeg)

1. P (plan) 計劃，包括方針和目標的確定，以及活動規劃的制定。

2. D (Do) 執行，根據已知的信息，設計具體的方法、方案和計劃布局；再根據設計和布局，進行具體運作，實現計劃中的內容。

3. C (check) 檢查，總結執行計劃的結果，分清哪些對了，哪些錯了，明確效果，找出問題。

4. A (Action)糾正，對總結檢查的結果進行處理，對成功的經驗加以肯定，並予以標準化；對於失敗的教訓也要總結，引起重視。對於沒有解決的問題，應提交給下一個PDCA循環中去解決。

但是，对于大部分公司或者创业团队，"快速试错"可能仅仅只是一句空洞的口号，或者老板比较铁血的，就是硬生生的用"血肉"去堆砌，营造出一个"赶英超美的大炼钢"时代，在这样的实践下，可能苦的不仅仅是员工，老板也很可能也得不到想要的结果。

> 我们都想要高效率、有价值的完成工作，在工作中提高自己，甚至带动团队提高，让每一个人都实现自己的价值。

那怎么办呢？

那当然要"改革开放"，那"改革开放"具体需要做什么？

* **我们需要站在巨人的肩膀上**

> ### 从"我们的兴趣爱好"中学习

在这里，容我再卖一个关子，我想举一些实际生活中的例子。

由于经济文化的发展，在当今的社会中，更多人已经非常关注生活质量，更加注重精神文明建设，我们都希望我们的人生更加的丰富多彩，而不仅仅只有工作，还有精彩的生活, 精彩的生活来源于精彩的体验，因此我们都会有自己的爱好。

我以滑雪来说好了，那么我们为我们的爱好都做了写什么呢？

1. 购买专业的私人的装备。
2. 做出科学的出行计划与行动安排。
3. 观看科学的专业的教练视频，甚至邀请专业的教练教导。
4. 投入了大量的练习时间与调研时间，一再地练习，一再地学习更加专业与科学的指引。

注意，我十分强调"科学的"、"专业的",为什么？

> 因为我们也并没有那么多时间，我们需要快速地掌握，而且我知道专业科学的指导能让我能少走弯路，事半功倍。

这是一个崇尚专业，崇尚效率的文化，这确实是一个健康的积极向上的氛围。

### 工作更应该崇尚专业
很简单，因为我们认为生活与工作同样的重要。

为什么我们工作中却更加忽视专业科学？

所以，放弃困兽之斗，别再总是freestyle, 我们需要吸收无数的前人总结的**最佳实践**，来重新审视我们的工作.

### 如何打造小而美的团队
*  引入科学专业的效率工具
	*  效率工具的核心价值 是 分解模型以致不超越人类个体的心智水平，以集体智慧去解决问题
*  以自服务，自动化和协作 作为核心文化
*  将关注点聚焦于**价值链交付流程**，而不再是自身的固有职能职责。

#### 需求分析阶段
* 引入用户故事
引用 **用户故事之父-jeff patton**的话:
>Story maps are for breaking down big stories as you tell them.

用户故事注重从一个大的故事，**从大到小**，**有步骤**，**有顺序**，**有主次**地进行分解故事

* 故事的分类（**从大到小**）
		![](/img/User-stories-Agile-Scrum-Belgium-Training.png)
* 典型的用户故事的卡片墙
	* **有步骤**，图片中的红色与橙色卡片，是用户活动与用户任务，体现了步骤的概念
	* **有顺序**，图片中的黄色的卡片，是真正的任务（也就是下面会说到的3C中的Card），可用于具体实施的开发任务，从左到右，任务的依赖次序
	* **有主次**， 图片中的黄色卡片中，会被分为不同的**泳道**，其中的Release1与Release2是将一个巨大的故事的分解有主次关系的版本，每一次的release的任务都是**最小可行产品（MVP）**
	![](/img/user-story-map.png)
* 物理卡片墙的使用场景
	* 物理墙的主要作用是为了让大家可以有一个集中沟通的地方，快速操作卡片
	* 物理墙很难体现工作进度，维护成本高
	![](/img/user-story-physical-wall.png)
	
* 3w - Who, What, How
	* 无时无刻不在思考以下三个核心的问题，在管理学中被称为“黄金圆环”，why > who > what
	![](/img/user-story-3w.jpg)
	
* 3C - Card, Conversation, Confirm
	* 卡片，沟通，验收之间的关系非常微妙互相作用，其中 **验收** 促进了 对于卡片与沟通的效果，要达到**“可验收”**的效果，我们必须将“卡片”做得更小，"沟通"更加细致。
	![](/img/user-story-3c.jpg)
	
* jira 故事看板
	* 使用jira工具来记录并富余更多的内容（外链资料，附件等）,更容易做到实时地了解当前的推进情况，进一步增加可视化的价值, 做到信息共享与透明。
	![](/img/user-story-jira.jpg)

#### 交付研发阶段
* 引入敏捷
> 引用[敏捷宣言](http://agilemanifesto.org/iso/zhchs/manifesto.html)

```
我们一直在实践中探寻更好的软件开发方法，
身体力行的同时也帮助他人。由此我们建立了如下价值观：

1. 个体和互动 高于 流程和工具
2. 工作的软件 高于 详尽的文档
3. 客户合作 高于 合同谈判
4. 响应变化 高于 遵循计划

也就是说，尽管右项有其价值，
我们更重视左项的价值。
```
	
* 敏捷团队组成
	1. Development Team, 依靠团队的力量，而非个人或者各垂直部门.
	2. Product Owner, 保证项目大方向的正确，解决外部矛盾，讨论中明确讨论范围与方向。
	3. ScrumMaster, 负责保持整个敏捷流程的进行。

* 注重与需求分析阶段的用户故事的联系
![](/img/easy-agile-user-story-maps.png)

* 绝大部分团队在实施敏捷只注重了研发过程的敏捷，缺失了应该要让整个交付过程，从需求分析开始，也就是用户故事开始的敏捷流程，从而造成
	1. **对开发团队单向的压力**, 不利用形成"背压", 让问题尽早暴露。
	2. **开发团队脱离于价值链条中，开发团队任务变成完成任务式** 往往容易造成任务交付质量问题，限制了成员思考与创造力，对团队的发展的思考限制在个别人身上形成瓶颈，以及团队成员个人价值感不强。
	![](/img/user-story-elephant.jpg)
	
* 从上述的用户故事的卡片中，建立迭代sprint周期.
 ![](/img/scrum-sprint.png)
* 配合jira的可视化，评估团队的瓶颈与任务并行能力，从而有针对性的解决瓶颈。
 ![](/img/how-scrum-works.png)
 
> 对所有非瓶颈处做出的优化都是徒劳

> **有效反馈循环**是敏捷的核心（无论是正向还是反向，正面还是反面）
![](/img/scrum-sprint-process.png)

#### 研发研发
* 纠正并引导研发团队中一味追求**高性能高并发**，而忽视了**良好设计**的价值导向。
* 推行**[领域驱动设计](http://www.infoq.com/cn/minibooks/domain-driven-design-quickly)**, 编写真正的**面向对象的**，**基于设计建模的**， **语义化的**， **可测试的**的程序代码。
* 对比以往的简单建模模型与DDD建模模型的区别。
	![](/img/ddd-contrast.jpg)
* 采用DDD指导后的系统架构图 - 洋葱模型
	* 更合理的功能分层与依赖关系，满足事务边界的清晰划分
	![](/img/ddd-onion.jpg)
	![](/img/ddd-classic-appoach.png)
* 以DDD为指导，注重建模环节, 简化建模环节，在建模环节将模型以聚合的概念分解，聚合内事务内聚，聚合外单一入口联系，聚合内追求强一致性， 聚合外追求最终一致性。
* 图中是ddd建模中涉及到所有的对象，以及之间的关系.
	![](/img/ddd-all-items.png)

* 基于产出中间产物（一般来说uml类图），与**领域专家** - 产品经理沟通确认。
	![](/img/ddd-aggregaterootstructure.png)
	* 基于中间产物建立**领域通用语言**，术语必须统一。
	* 中间产物是双方沟通今后的基础，在落实层面同时指导产品与技术的变更。 
	![](/img/ddd-uml-code.jpg)
	
* 采用DDD编写的代码具有强可测试性，在代码编写中实现单元测试代码, 与最开始的用户故事阶段的 **可验收** 相呼应， 增强代码交付的信心。


#### 开发联调部署阶段
* 引入可持续集成
	* 代码分支管理，推行业界主流[git flow](https://www.git-tower.com/learn/git/ebook/cn/command-line/advanced-topics/git-flow)流程, 以保证多人协作任务的顺利完成。
	![](/img/git-flow.svg)
	* 代码[merge-request](https://docs.gitlab.com/ee/gitlab-basics/add-merge-request.html)的引入，加入[code review](http://www.jianshu.com/p/6bcd082101c1)环节。
	* gitlab-ci的pipeline的引入，每次的提交触发流水线验收，包括代码风格检查，单元测试，集成测试，代码文档生成与发布，保证代码永远可用，增强交付信心。
		![](/img/cicd_pipeline_infograph.png)
	* 推行**配置即代码**的思想，将所有的环境配置与依赖都包含到代码中，配置**docker镜像交付**，消除环境部署与环境不一致的问题导致的 **反工作类型的问题排查** 以及 **不必要的沟通**。
	* 开发测试环境引入rancher,一键创建系统以及系统依赖，提供稳定的快速的开发测试环境。
	
	
	以上，并不是说我们需要一步到位做到，但是确实我们所追求的目标，需要让团队的所有人知道，你们所遇到的某一个困难我们都知道，而且我们都有科学的方案来去不断优化与解决，保持信心，往这样一个共同的“小而美”目标前进，愿我们每一个人都在这个过程中收益良多。
	未完待续……